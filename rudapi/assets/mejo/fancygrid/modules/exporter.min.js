Fancy.define("Fancy.grid.plugin.Exporter",{extend:Fancy.Plugin,ptype:"grid.exporter",inWidgetName:"exporter",constructor:function(a){this.Super("const",arguments)},init:function(){},exportToExcel:function(){function a(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d!=a.length;++d)c[d]=255&a.charCodeAt(d);return b}var b=this,c=b.widget,d=b.getColumnsData(),e=b.getData(),f=[d].concat(e),g=function(){if(!(this instanceof g))return new g;this.SheetNames=[],this.Sheets={}},h=new g,i=b.sheet_from_array_of_arrays(f);i["!cols"]=[],Fancy.each(b.widths,function(a){i["!cols"].push({wch:a})});var j=c.title||"grid_data";h.SheetNames.push(j),h.Sheets[j]=i;var k=XLSX.write(h,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([a(k)],{type:"application/octet-stream"}),j+".xlsx")},getColumnsData:function(){var a=this,b=a.widget,c=[].concat(b.leftColumns).concat(b.columns).concat(b.rightColumns),d=[];return a.widths=[],Fancy.each(c,function(b){a.widths.push(b.width),d.push(b.title||"")}),d},getData:function(){var a=this,b=a.widget,c=[],d=b.getDisplayedData();return Fancy.each(d,function(a){var b=[];Fancy.each(a,function(a){b.push(a)}),c.push(b)}),c},sheet_from_array_of_arrays:function(a,b){for(var c={},d={s:{c:1e7,r:1e7},e:{c:0,r:0}},e=0,f=a.length,g=function(a,b){return b&&(a+=1462),(Date.parse(a)-new Date(Date.UTC(1899,11,30)))/864e5};e!=f;++e)for(var h=0;h!=a[e].length;++h){d.s.r>e&&(d.s.r=e),d.s.c>h&&(d.s.c=h),d.e.r<e&&(d.e.r=e),d.e.c<h&&(d.e.c=h);var i={v:a[e][h]};if(null!=i.v){var j=XLSX.utils.encode_cell({c:h,r:e});"number"==typeof i.v?i.t="n":"boolean"==typeof i.v?i.t="b":i.v instanceof Date?(i.t="n",i.z=XLSX.SSF._table[14],i.v=g(i.v)):i.t="s",c[j]=i}}return d.s.c<1e7&&(c["!ref"]=XLSX.utils.encode_range(d)),c}});