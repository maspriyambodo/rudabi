!function(){var a=Fancy,b=a.MENU_CLS,c=a.MENU_ITEM_CLS,d=a.MENU_ITEM_IMAGE_CLS,e=a.MENU_ITEM_TEXT_CLS,f=a.MENU_ITEM_ACTIVE_CLS,g=a.MENU_ITEM_RIGHT_IMAGE_CLS,h=a.MENU_ITEM_EXPAND_CLS;Fancy.define("Fancy.Menu",{extend:Fancy.Widget,constructor:function(a,b){Fancy.applyConfig(this,a),this.Super("const",arguments)},init:function(){var a=this;a.addEvents("hide"),a.Super("init",arguments),a.applyDefaults(),a.render(),a.ons()},ons:function(){var a=this,b=a.el;b.on("mousedown",a.onItemMouseDown,a,"."+c),b.on("click",a.onItemClick,a,"."+c),b.on("mouseenter",a.onItemEnter,a,"."+c),b.on("mouseleave",a.onItemLeave,a,"."+c)},widgetCls:b,itemCls:c,itemImageCls:d,cls:"",extraCls:"",width:142,itemHeight:30,rendered:!1,theme:"default",render:function(){var a,b=this,c=Fancy.get(document.createElement("div"));b.fire("beforerender"),"default"!==b.theme&&c.addCls("fancy-theme-"+b.theme),c.addClass(Fancy.cls,b.widgetCls,b.cls,b.extraCls),c.css({width:b.width,height:b.getItemsHeight()}),a=Fancy.get(b.renderTo||document.body),b.el=a.dom.appendChild(c.dom),b.el=Fancy.get(b.el),b.renderItems(),b.fire("afterrender"),b.fire("render"),b.rendered=!0},getItemsHeight:function(){for(var a=0,b=0,c=this.items.length;b<c;b++)a+=this.itemHeight;return a},renderItems:function(){for(var a,b=this,c=0,f=b.items.length;c<f;c++){a=b.items[c];var i=Fancy.get(document.createElement("div"));i.attr("index",c),i.addCls(b.itemCls),i.css("height",b.itemHeight),b.el.dom.appendChild(i.dom),a.el=i;var j=a.imageCls||"";switch(a.cls&&i.addCls(a.cls),i.update([!1===a.image?"":'<div class="'+d+" "+j+'"></div>','<div class="'+e+'"></div>','<div class="'+g+" "+(a.items?h:"")+'"></div>'].join("")),!1===a.image&&i.addCls("fancy-menu-item-no-image"),a.type){case"":break;default:i.select("."+e).item(0).update(a.text||"")}void 0!==a.checked&&(b.items[c].checkbox=new Fancy.CheckBox({label:!1,theme:b.theme,padding:"1px 8px 0px",renderTo:i.select("."+d).item(0).dom,value:a.checked}))}},applyDefaults:function(){var a=this,b=0,c=a.items.length;if(a.defaults)for(;b<c;b++)Fancy.applyIf(a.items[b],a.defaults)},onItemClick:function(a){var b=this,c=Fancy.get(a.currentTarget),d=c.attr("index"),e=b.items[d],f=[b,e];e.handler&&(e.scope?e.handler.apply(e.scope,f):e.handler(b,e))},onItemEnter:function(a){var b=this,c=Fancy.get(a.currentTarget),d=c.attr("index"),e=b.items[d],f=c.offset();if(b.shownSubMenu&&b.shownSubMenu.hide(),b.deActivateItem(),b.activateItem(d),e.items){if(!e.menu){var g=b.items[d];Fancy.apply(g,{parentItem:e,parentMenu:b,defaults:e.defaults,items:e.items,theme:b.theme}),b.items[d].menu=new Fancy.Menu(g)}e.menu.showAt(f.left+parseInt(c.width()),f.top),b.shownSubMenu=e.menu}},onItemLeave:function(a){},showAt:function(a,b){var c=this;c.css("position","absolute"),c.css("left",a),c.css("top",b),c.el.show(),c.parentMenu||Fancy.MenuManager.add(c)},hide:function(){var a=this;a.el.hide(),a.deActivateItem(),a.shownSubMenu&&a.shownSubMenu.hide(),a.fire("hide")},hideAll:function(){var a=this.parentMenu;a&&"none"!==a.el.css("display")&&a.hide(),this.hide()},activateItem:function(a){var b=this.items[a];this.activeItem=b,b.el.addCls(f)},deActivateItem:function(){var a=this.activeItem;a&&(a.el.removeClass(f),delete this.activeItem)},onItemMouseDown:function(a){a.preventDefault()}}),Fancy.define("Fancy.MenuManager",{singleton:!0,inited:!1,constructor:function(){},init:function(){Fancy.get(document).on("click",this.onDocClick,this)},add:function(a){var b=this;b.inited||b.init(),b.activeMenu=a},onDocClick:function(a){var c=this,d=Fancy.get(a.target),e=10,f=d;if(c.activeMenu){for(;e>0&&f.dom;){if(f.hasCls(b))return;f=f.parent(),e--}c.activeMenu.hide(),delete c.activeMenu}}})}(),function(){var a=Fancy,b=a.GRID_HEADER_COLUMN_TRIGGERED_CLS,c=a.GRID_HEADER_CELL_TRIGGER_UP_CLS,d=a.GRID_HEADER_CELL_TRIGGER_DOWN_CLS;a.Mixin("Fancy.grid.header.mixin.Menu",{triggeredColumnCls:b,triggerUpCls:c,triggerDownCls:d,showMenu:function(c,d,e,f){var g=this,h=g.widget,i=c.offset();g.hideMenu(),c.addCls(b),e.menu.rendered?g.updateColumnsMenu(e,f):(e.menu=g.generateMenu(e,f),e.menu=new a.Menu({column:e,items:e.menu,theme:h.theme,events:[{hide:g.onMenuHide,scope:g}]})),e.menu.showAt(i.left+parseInt(c.css("width"))-26,i.top+parseInt(c.css("height"))-1),g.activeMenu=e.menu,g.activeCell=c},hideMenu:function(){var a=this,c=a.widget,d=c.header,e=c.rightHeader,f=c.leftHeader;switch(a.side){case"left":d.activeMenu&&(d.activeMenu.hide(),d.activeCell.removeCls(b),delete d.activeMenu,delete d.activeCell),e.activeMenu&&(e.activeMenu.hide(),e.activeCell.removeCls(b),delete e.activeMenu,delete e.activeCell);break;case"center":f.activeMenu&&(f.activeMenu.hide(),f.activeCell.removeCls(b),delete f.activeMenu,delete f.activeCell),e.activeMenu&&(e.activeMenu.hide(),e.activeCell.removeCls(b),delete e.activeMenu,delete e.activeCell);break;case"right":f.activeMenu&&(f.activeMenu.hide(),f.activeCell.removeCls(b),delete f.activeMenu,delete f.activeCell),d.activeMenu&&(d.activeMenu.hide(),d.activeCell.removeCls(b),delete d.activeMenu,delete d.activeCell)}a.activeMenu&&(a.activeMenu.hide(),a.activeCell.removeCls(b)),delete a.activeMenu,delete a.activeCell},generateMenu:function(a,b){for(var e,f=this,g=f.widget,h=g.lang,i=[],j="",k=0,l=b.length;k<l;k++)if(a.index===b[k].index){e=k;break}switch(!1===a.sortable&&(j="fancy-menu-item-disabled"),a.sortable&&(i.push({text:h.sortAsc,cls:j,imageCls:c,handler:function(){g.sorter.sort("asc",a.index,f.side),a.menu.hide()}}),i.push({text:h.sortDesc,cls:j,imageCls:d,handler:function(){g.sorter.sort("desc",a.index,f.side),a.menu.hide()}})),i.push({text:h.columns,index:"columns",items:f.prepareColumns(b)}),f.side){case"left":case"right":!1!==a.lockable&&i.push({text:"Unlock",handler:function(){a.menu.hide(),g.unLockColumn(e,f.side)}});break;case"center":b.length>1&&g.leftColumns.length&&!1!==a.lockable&&i.push({text:"Lock",handler:function(){a.menu.hide(),g.lockColumn(e,f.side)}}),b.length>1&&g.rightColumns.length&&!1!==a.lockable&&i.push({text:"Right Lock",handler:function(){a.menu.hide(),g.rightLockColumn(e,f.side)}})}return i},prepareColumns:function(a){for(var b,c=this,d=c.widget,e=[],f=0,g=a.length,h=[];f<g;f++){var i=!0,j=a[f];j.hidden&&(i=!1);var k={text:j.title,checked:i,index:j.index,handler:function(a,b){if(!0!==b.checked||b.checkbox.get()||b.checkbox.set(!0),b.checked&&1===a.el.select(".fancy-checkbox-on").length)return void b.checkbox.set(!0);b.checked=!b.checked,b.checkbox.set(b.checked),b.checked?d.showColumn(c.side,b.index):d.hideColumn(c.side,b.index)}};j.grouping?(h=h||[],h.push(k),b=j.grouping):(h.length&&(e.push({text:b,items:h}),b=void 0,h=[]),e.push(k))}return h.length&&e.push({text:b,items:h}),e},onMenuHide:function(){this.el.select("."+b).removeCls(b)},updateColumnsMenu:function(a,b,c){for(var d,e,f=this,g=a.menu,h=0,i=g.items.length;h<i;h++)if(e=g.items[h],"columns"===e.index){d=e;break}h=0,i=d.items.length;for(var j=!1;h<i;h++){e=d.items[h];var k=b[h];e.checkbox&&(e.checkbox.set(!k.hidden,!1),j=!0)}j||c||(d.items=f.prepareColumns(b))},destroyMenus:function(){for(var b,c=this,d=c.widget,e=d.getColumns(c.side),f=0,g=e.length;f<g;f++)b=e[f],a.isObject(b.menu)&&b.menu.destroy()}})}();