Fancy.Mixin("Fancy.store.mixin.Paging",{initPaging:function(){var a=this;void 0!==a.paging&&(Fancy.isObject(a.paging)&&Fancy.apply(a,a.paging),a.calcPages(),a.changeDataView())},firstPage:function(){var a=this;a.calcPages(),a.showPage=0,"server"===a.pageType?a.loadPage():a.changeDataView()},prevPage:function(){var a=this;a.calcPages(),a.showPage--,a.showPage<0&&(a.showPage=0),"server"===a.pageType?a.loadPage():a.changeDataView()},nextPage:function(){var a=this;a.calcPages(),a.showPage++,a.showPage===a.pages&&a.showPage--,a.showPage<0&&(a.showPage=0),"server"===a.pageType?a.loadPage():a.changeDataView()},lastPage:function(){var a=this;a.calcPages(),a.showPage=a.pages-1,a.showPage<0&&(a.showPage=0),"server"===a.pageType?a.loadPage():a.changeDataView()},calcPages:function(){var a=this;if("server"===a.pageType){var b=a.pages;if(a.pages=Math.ceil(a.getTotal()/a.pageSize),!isNaN(b)&&b>a.pages)return a.showPage--,a.showPage<0&&(a.showPage=0),"needs reload"}else a.pages=Math.ceil(a.getTotal()/a.pageSize);a.showPage>=a.pages&&(a.showPage=a.pages-1),a.showPage<0&&(a.showPage=0),a.fire("changepages")},setPage:function(a){var b=this;b.showPage=a,b.showPage===b.pages&&b.showPage--,b.showPage<0&&(b.showPage=0),"server"===b.pageType?b.loadPage():b.changeDataView()},refresh:function(){var a=this;"server"===a.pageType?a.loadPage():a.changeDataView()},processPagingData:function(a){var b=this;void 0!==a.totalCount&&(b.totalCount=a.totalCount),b.checkPagingType(a),b.setData(a[b.readerRootProperty]),b.changeDataView({stoppedFilter:!0}),"needs reload"===b.calcPages()&&b.loadPage()},checkPagingType:function(a){var b=this;void 0!==a.totalCount&&a.totalCount!==a[b.readerRootProperty].length&&(b.totalCount=a.totalCount,b.pageType="server",void 0===b.remoteSort&&(b.remoteSort=!0))},loadPage:function(){this.loadData()},setPageSize:function(a){var b=this;b.pageSize=a,b.calcPages(),"server"===b.pageType?b.loadPage():b.changeDataView()}}),Fancy.define("Fancy.grid.plugin.Paging",{extend:Fancy.Plugin,ptype:"grid.paging",inWidgetName:"paging",barType:"bbar",constructor:function(a){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var a=this,b=a.widget,c=b.store;c.on("change",a.onChangeStore,a),c.on("remove",a.onChangeStore,a),c.on("filter",a.onChangeStore,a),b.on("render",a.onRenderGrid,a),b.on("docmove",a.onDocMouseMove,a)},setPageSize:function(a){this.widget.store.setPageSize(a)},nextPage:function(){this.widget.store.nextPage()},lastPage:function(){this.widget.store.lastPage()},prevPage:function(){this.widget.store.prevPage()},firstPage:function(){this.widget.store.firstPage()},onChangeStore:function(a){var b,c=this,d=c.widget,e=d.store,f=d.panel;switch(c.barType){case"both":b=f._bbar.roles.pagenumber,b.setValue(e.showPage+1),b=f._tbar.roles.pagenumber,b.setValue(e.showPage+1),c.updateBar("tbar"),c.updateBar("bbar");break;case"none":case!1:break;default:b=f["_"+c.barType].roles.pagenumber,b.setValue(e.showPage+1),c.updateBar()}d.setSidesHeight(),d.fire("changepage")},setPage:function(a){var b=this,c=b.widget,d=c.store;return a<0?a=0:a>d.pages&&(a=d.pages),d.setPage(a),a},refresh:function(){var a=this,b=a.widget,c=b.store;b.showLoadMask(),setTimeout(function(){c.refresh(),"server"!==c.pageType&&b.hideLoadMask()},200)},updateBar:function(a){var b=this,c=b.widget,d=c.store,e=d.showPage,f=d.pageSize,g=d.pages,h=c.panel,a=a||b.barType,i=h["_"+a].roles,j=i.pagenumber,k=i.ofText,l=i.info,m=i.first,n=i.prev,o=i.next,p=i.last,q=e*f+1,r=q+f,s=d.getTotal()||0,t=c.lang;r>s&&(r=s),0===r&&(q=0),j.setValue(d.showPage+1),k.el.update(Fancy.String.format(t.paging.of,[g||1])),l.el.update(Fancy.String.format(t.paging.info,[q,r,s])),0===e?(m.disable(),n.disable()):(m.enable(),n.enable()),g-1===e||0===g?(p.disable(),o.disable()):(p.enable(),o.enable())},onRenderGrid:function(){var a=this;switch(a.barType){case"both":a.updateBar("tbar"),a.updateBar("bbar");break;case"none":case!1:break;default:a.updateBar()}},onDocMouseMove:function(){var a=this,b=a.widget;"none"===b.el.css("display")||b.panel&&b.panel.el&&"none"===b.panel.el.css("display")?a.wasHidden||(Fancy.combo.Manager.hideLists(),a.wasHidden=!0):a.wasHidden=!1}});