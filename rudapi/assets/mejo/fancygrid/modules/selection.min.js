!function(){var a=Fancy,b=a.FIELD_CHECKBOX_CLS,c=a.GRID_CELL_CLS,d=a.GRID_CELL_OVER_CLS,e=a.GRID_CELL_SELECTED_CLS,f=a.GRID_COLUMN_CLS,g=a.GRID_COLUMN_OVER_CLS,h=a.GRID_COLUMN_SELECT_CLS,i=a.GRID_COLUMN_SELECTED_CLS,j=a.GRID_ROW_OVER_CLS,k=a.GRID_HEADER_CELL_SELECT_CLS;a.define("Fancy.grid.plugin.Selection",{extend:a.Plugin,ptype:"grid.selection",inWidgetName:"selection",mixins:["Fancy.grid.selection.mixin.Navigation"],enabled:!0,checkboxRow:!1,checkOnly:!1,memory:!1,constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.memory&&a.initMemory(),a.ons()},ons:function(){var b=this,c=b.widget;c.once("render",function(){b.initTrackOver(),b.initColumnTrackOver(),b.initCellTrackOver(),b.initCellSelection(),b.initRowSelection(),b.initColumnSelection(),c.keyNavigation&&b.initNavigation(),c.on("changepage",b.onChangePage,b),a.nojQuery&&b.initFixTrackOver()}),c.on("sort",b.onSort,b),c.on("columndrag",b.onColumnDrag,b),c.on("lockcolumn",b.onColumnLock,b),c.on("rightlockcolumn",b.onColumnRightLock,b),c.on("unlockcolumn",b.onUnColumnLock,b)},initMemory:function(){var b=this;b.memory={all:!1,except:{},selected:{},setAll:function(){a.apply(b.memory,{all:!0,except:{},selected:{}})},clearAll:function(){a.apply(b.memory,{all:!1,except:{},selected:{}})}}},initTrackOver:function(){var a=this,b=a.widget;b.on("rowenter",a.onRowEnter,a),b.on("rowleave",a.onRowLeave,a)},initCellTrackOver:function(){var a=this,b=a.widget;b.on("cellenter",a.onCellEnter,a),b.on("cellleave",a.onCellLeave,a)},initColumnTrackOver:function(){var a=this,b=a.widget;b.on("columnenter",a.onColumnEnter,a),b.on("columnleave",a.onColumnLeave,a)},onCellEnter:function(b,c){var e=this.widget;e.cellTrackOver&&!e.startResizing&&a.get(c.cell).addCls(d)},onCellLeave:function(b,c){var e=this.widget;e.cellTrackOver&&!e.startResizing&&a.get(c.cell).removeCls(d)},onColumnEnter:function(b,c){var d=this.widget,e=d.scroller;d.startResizing||!d.columnTrackOver||e.bottomKnobDown||e.rightKnobDown||!1===c.column.trackOver||a.get(c.columnDom).addCls(g)},onColumnLeave:function(b,c){var d=this.widget;d.startResizing||d.columnTrackOver&&a.get(c.columnDom).removeCls(g)},onRowEnter:function(b,c){var d=this.widget,e=d.scroller;if(!d.startResizing&&!1!==this.enabled&&d.trackOver&&!e.bottomKnobDown&&!e.rightKnobDown){var f=d.getDomRow(c.rowIndex);a.each(f,function(b){a.get(b).addCls(j)}),d.fire("rowtrackenter",c)}},onRowLeave:function(b,c){var d=this.widget;if(!d.startResizing&&!1!==this.enabled&&d.trackOver){var e=d.getDomRow(c.rowIndex);a.each(e,function(b){a.get(b).removeCls(j)}),d.fire("rowtrackleave",c)}},onChangePage:function(){this.memory||this.clearSelection()},initCellSelection:function(){var a=this,b=a.widget;b.on("cellclick",a.onCellClick,a),b.on("cellmousedown",a.onCellMouseDownCells,a),b.on("cellenter",a.onCellEnterSelection,a)},initRowSelection:function(){var a=this,b=a.widget;b.checkboxRowSelection&&(a.checkboxRow=!0,setTimeout(function(){"rows"===a.selModel&&a.renderHeaderCheckBox()},1)),b.on("rowclick",a.onRowClick,a),b.on("cellmousedown",a.onCellMouseDownRows,a),b.on("cellclick",a.onCellClickRows,a),b.on("rowenter",a.onRowEnterSelection,a)},onCellMouseDownRows:function(c,d){var f=this,g=f.widget;if(f.rows&&f.enabled&&(!f.checkOnly||"$selected"===d.column.index)){var h=d.e,i=h.target,j=h.ctrlKey,k=d.rowIndex,l=g.getDomRow(k);if(j&&g.multiSelect)a.get(l[0]).hasCls(e)?(f.domDeSelectRow(k),f.checkboxRow&&f.deSelectCheckBox(k)):(f.domSelectRow(k),f.checkboxRow&&f.selectCheckBox(k));else if("$selected"===d.column.index){var m=a.getWidget(a.get(d.cell).select("."+b).attr("id"));m.el.within(i)?(f.domSelectRow(k),!0===m.get()?f.domDeSelectRow(k):f.domSelectRow(k)):(f.clearSelection(),f.domSelectRow(k),f.checkboxRow&&f.selectCheckBox(k))}else f.clearSelection(),f.domSelectRow(k),f.checkboxRow&&f.selectCheckBox(k);f.isMouseDown=!0,f.startRowSelection=k,a.$(document).one("mouseup",function(){delete f.isMouseDown,delete f.startCellSelection}),g.fire("select")}},selectCheckBox:function(d){var e=this,f=e.widget;f.el.select("."+h+" ."+c+'[index="'+d+'"] .'+b).each(function(b){a.getWidget(b.attr("id")).set(!0)}),"rows"===f.selModel&&e.clearHeaderCheckBox()},deSelectCheckBox:function(d){var e=this,f=e.widget,g=f.store,i=f.el.select("."+h+" ."+c+'[index="'+d+'"] .'+b),j=g.get(d,"id");j&&(e.memory&&(e.memory.except[j]=!0,delete e.memory.selected[j]),i.each(function(b){a.getWidget(b.attr("id")).set(!1)}),e.clearHeaderCheckBox())},domSelectRow:function(b){var c=this,d=c.widget,f=d.store,g=d.getDomRow(b),h=f.get(b,"id");d.startResizing||(c.memory&&(delete c.memory.except[h],c.memory.selected[h]=!0),a.each(g,function(b){a.get(b).addCls(e)}))},domDeSelectRow:function(b){var c=this.widget,d=c.getDomRow(b);a.each(d,function(b){a.get(b).removeCls(e)})},onColumnEnterSelection:function(a,b){var c=this,d=c.widget;if(c.columns&&!0===c.isMouseDown){var e={columnIndex:c.startColumnColumnIndex,side:c.startColumnSide},f={columnIndex:b.columnIndex,side:b.side};if(e.side===f.side){switch(e.side){case"center":c.clearSelection("right"),c.clearSelection("left");break;case"left":c.clearSelection("center"),c.clearSelection("right");break;case"right":c.clearSelection("center"),c.clearSelection("left")}c.selectColumns(e.columnIndex,f.columnIndex,e.side)}else"center"===e.side&&"right"===f.side?(c.selectColumns(e.columnIndex,d.columns.length,"center"),c.selectColumns(0,f.columnIndex,"right")):"center"===e.side&&"left"===f.side?(c.selectColumns(0,e.columnIndex,"center"),c.selectColumns(f.columnIndex,d.leftColumns.length,"left")):"left"===e.side&&"center"===f.side?(c.clearSelection("right"),c.selectColumns(e.columnIndex,d.leftColumns.length,"left"),c.selectColumns(0,f.columnIndex,"center")):"left"===e.side&&"right"===f.side?(c.selectColumns(e.columnIndex,d.leftColumns.length,"left"),c.selectColumns(0,d.columns.length,"center"),c.selectColumns(0,f.columnIndex,"right")):"right"===e.side&&"center"===f.side?(c.clearSelection("left"),c.selectColumns(0,e.columnIndex,"right"),c.selectColumns(f.columnIndex,d.columns.length,"center")):"right"===e.side&&"left"===f.side&&(c.selectColumns(0,e.columnIndex,"right"),c.selectColumns(0,d.columns.length,"center"),c.selectColumns(f.columnIndex,d.leftColumns.length,"left"))}},onRowEnterSelection:function(a,b){var c=this,d=c.widget;if(!d.startResizing&&!1!==c.enabled&&c.rows&&!0===c.isMouseDown){var e=c.startRowSelection,f=b.rowIndex,g={};e>f&&(e=b.rowIndex,f=c.startRowSelection);for(var h=e,i=f+1;h<i;h++)g[h]=!0;var j=c.getSelectedRowByColumn(b.columnIndex,b.side),k={},l={};for(var m in g)!0!==j[m]&&(k[m]=!0);for(var m in j)!0!==g[m]&&(l[m]=!0);for(var m in k)c.domSelectRow(m),c.checkboxRow&&c.selectCheckBox(m);for(var m in l)c.domDeSelectRow(m),c.checkboxRow&&c.deSelectCheckBox(m);d.fire("select")}},getSelectedRowByColumn:function(a,b){var c,d=this.widget;switch(b){case"left":c=d.leftBody;break;case"center":c=d.body;break;case"right":c=d.rightBody}var g=c.el.select("."+f+'[index="'+a+'"][grid="'+d.id+'"]'),h=g.select("."+e),i={};return h.each(function(a){i[Number(a.attr("index"))]=!0}),i},getSelectedRow:function(){var a=this.widget,b=a.body,c=b.el.select("."+e);return 0===c.length?-1:Number(c.item(0).attr("index"))},getSelectedRows:function(){var a=this.widget,b=a.body,c=b.el.select("."+f+'[index="0"][grid="'+a.id+'"]'),d=c.select("."+e),g=[];return d.each(function(a){g.push(Number(a.attr("index")))}),g},initColumnSelection:function(){var a=this,b=a.widget;a.selectedColumns=[],b.on("columnclick",a.onColumnClick,a),b.on("columnmousedown",a.onColumnMouseDown,a),b.on("columnenter",a.onColumnEnterSelection,a)},onColumnClick:function(b,c){var d=this;if(d.column&&!1!==c.column.selectable){var e=a.get(c.columnDom);d.column&&(d.selectedColumns[0]=c),d.clearSelection(),e.addCls(i)}},onRowClick:function(c,d){var f=this,g=f.widget,h=d.rowIndex;if(f.row&&!1!==d&&(!f.checkOnly||"$selected"===d.column.index)){var i=d.column,j=!0;"action"===i.type&&i.items&&a.each(i.items,function(a){"remove"===a.action&&(j=!1)}),f.clearSelection();var k=g.getDomRow(h);if("$selected"===d.column.index){!0===a.getWidget(a.get(d.cell).select("."+b).attr("id")).get()?(f.selectCheckBox(h),a.each(k,function(b){a.get(b).addCls(e)})):f.deSelectCheckBox(h)}else j&&(a.each(k,function(b){a.get(b).addCls(e)}),f.selectCheckBox(h),g.fire("select"))}},onCellClickRows:function(c,d){var e=this,f=e.widget;if(e.rows&&e.enabled&&(!e.checkOnly||"$selected"===d.column.index)){var g=d.e,h=g.ctrlKey,i=d.rowIndex;if(h&&f.multiSelect);else if("$selected"===d.column.index){var j=a.getWidget(a.get(d.cell).select("."+b).attr("id"));!0===j.get()?e.selectCheckBox(i):e.deSelectCheckBox(i)}}},selectRow:function(b){var c=this,d=c.widget;if(!d.startResizing){if(!c.row&&!c.rows)throw new Error("[FancyGrid Error] - row selection was not enabled");c.clearSelection();var f=d.getDomRow(b);a.each(f,function(b){a.get(b).addCls(e)}),d.fire("select")}},onCellClick:function(b,c){var d=this,f=d.widget;d.cell&&(d.clearSelection(),a.get(c.cell).addCls(e),f.fire("select"))},clearSelection:function(a){var b=this,c=b.widget;if(b.checkboxRow){c.body.el.select("."+f+'[index="0"] .'+e).each(function(a){var c=a.attr("index");b.deSelectCheckBox(c)}),b.memory&&b.memory.clearAll()}if(a)switch(a){case"left":c.leftBody.el.select("."+e).removeCls(e),c.leftBody.el.select("."+i).removeCls(i),c.leftBody.el.select("."+d).removeCls(d);break;case"center":c.body.el.select("."+e).removeCls(e),c.body.el.select("."+i).removeCls(i),c.body.el.select("."+d).removeCls(d);break;case"right":c.rightBody.el.select("."+e).removeCls(e),c.rightBody.el.select("."+i).removeCls(i),c.rightBody.el.select("."+d).removeCls(d)}else c.el.select("."+e).removeCls(e),c.el.select("."+i).removeCls(i),c.el.select("."+d).removeCls(d);c.fire("clearselect")},onSort:function(){this.memory||this.clearSelection()},onCellEnterSelection:function(a,b){var c=this,d=c.widget,e=0;if(c.cells&&!0===c.isMouseDown){c.prevCellsSelection=b.cell,c.prevCellRowIndex=b.rowIndex,c.prevCellColumnIndex=b.columnIndex,c.prevCellSide=b.side;var f={rowIndex:c.startCellRowIndex,columnIndex:c.startCellColumnIndex,side:c.startCellSide},g={rowIndex:b.rowIndex,columnIndex:b.columnIndex,side:b.side};b.rowIndex<c.startCellRowIndex&&(f.rowIndex=b.rowIndex,g.rowIndex=c.startCellRowIndex),c.startCellSide===b.side?(b.columnIndex<c.startCellColumnIndex&&(f.columnIndex=b.columnIndex,g.columnIndex=c.startCellColumnIndex),e=c.selectCells(f,g,f.side),"left"===c.startCellSide?(c.clearSelection("center"),c.clearSelection("right")):"center"===c.startCellSide?(c.clearSelection("left"),c.clearSelection("right")):"right"===c.startCellSide&&(c.clearSelection("left"),c.clearSelection("center"))):"left"===c.startCellSide?(e=c.selectCells(f,{rowIndex:b.rowIndex,columnIndex:d.leftColumns.length-1},"left"),"center"===b.side?(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},g,"center"),c.clearSelection("right")):"right"===b.side&&(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},g,"right"))):"center"===c.startCellSide?"left"===b.side?(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{rowIndex:g.rowIndex,columnIndex:f.columnIndex},"center"),e+=c.selectCells({columnIndex:g.columnIndex,rowIndex:f.rowIndex},{rowIndex:g.rowIndex,columnIndex:d.leftColumns.length-1},"left")):"right"===b.side&&(e+=c.selectCells({columnIndex:f.columnIndex,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:g.columnIndex,rowIndex:g.rowIndex},"right")):"right"===c.startCellSide&&(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:f.columnIndex,rowIndex:g.rowIndex},"right"),"center"===b.side?(e+=c.selectCells({columnIndex:g.columnIndex,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),c.clearSelection("left")):"left"===b.side&&(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),e+=c.selectCells({columnIndex:g.columnIndex,rowIndex:f.rowIndex},{columnIndex:d.leftColumns.length-1,rowIndex:g.rowIndex},"left"))),c.endCellRowIndex=g.rowIndex,d.fire("select")}},onColumnMouseDown:function(b,c){var d=this,e=d.widget;if(d.columns&&!1!==c.column.selectable&&d.enabled){var f=a.get(c.columnDom);d.isMouseDown=!0,d.startColumnColumnIndex=c.columnIndex,d.startColumnSide=c.side,d.clearSelection(),f.addCls(i),a.$(document).one("mouseup",function(){delete d.isMouseDown}),e.fire("select")}},onCellMouseDownCells:function(b,c){var d=this,f=d.widget;if(f.celledit&&f.celledit.hideEditor(),d.cells&&d.enabled){var g=a.get(c.cell);d.clearSelection(),g.addCls(e),d.isMouseDown=!0,d.startCellSelection=c.cell,d.startCellRowIndex=c.rowIndex,d.startCellColumnIndex=c.columnIndex,d.startCellSide=c.side,a.$(document).one("mouseup",function(){delete d.isMouseDown,delete d.startCellSelection}),f.fire("select")}},selectCells:function(a,b,c){var d,f,g,h=this,i=h.widget,j=i.body,k=i.leftBody,l=i.rightBody,m=a.rowIndex,n=b.rowIndex+1,o=h.getSelectedCells(c||"center"),p={},q={},r={};for(m=a.rowIndex,n=b.rowIndex+1;m<n;m++)for(p[m]=p[m]||{},f=a.columnIndex,g=b.columnIndex+1;f<g;f++)p[m][f]=!0;for(var s in p)if(void 0===o[s])q[s]=p[s];else for(var t in p[s])!0!==o[s][t]&&(q[s]=q[s]||{},q[s][t]=!0);for(var s in o)if(void 0===p[s])r[s]=o[s];else for(var t in o[s])!0!==p[s][t]&&(r[s]=r[s]||{},r[s][t]=!0);switch(c){case"left":d=k;break;case"center":d=j;break;case"right":d=l;break;default:d=j}for(var s in q)for(var t in q[s]){var u=d.getCell(s,t);u.addCls(e)}for(var s in r)for(var t in r[s]){var u=d.getCell(s,t);u.removeCls(e)}},getSelectedCells:function(a){for(var b=this,c=b.widget,d=c.getBody(a||"center"),f=d.el.select("."+e),g={},h=0,i=f.length;h<i;h++){var j=f.item(h),k=Number(j.parent().attr("index")),l=Number(j.attr("index"));g[l]=g[l]||{},g[l][k]=!0}return g},getNumberSelectedCells:function(){return this.widget.el.select("."+e).length},getSelectedColumns:function(a){for(var b=this.widget,c=b.getBody(a),d={},e=c.el.select("."+i),f=0,g=e.length;f<g;f++)d[e.item(f).attr("index")]=!0;return d},selectColumns:function(a,b,c){var d=this,e=d.getSelectedColumns(c||"center"),f={},g={},h={},i=a,j=b;for(j<i&&(i=b,j=a),j++;i<j;i++)f[i]=!0;for(var k in f)!0!==e[k]&&(g[k]=!0);for(var k in e)!0!==f[k]&&(h[k]=!0);for(var k in g)d.selectColumn(k,c);for(var k in h)d.deselectColumn(k,c)},selectColumn:function(b,c){var d=this.widget,e=d.getBody(c||"center");a.get(e.getDomColumn(b)).addCls(i)},deselectColumn:function(b,c){var d=this.widget,e=d.getBody(c||"center");a.get(e.getDomColumn(b)).removeCls(i)},getSelection:function(a){var b=this,c=b.widget,d=c.store,e={};switch(b.selModel){case"row":e.row=b.getSelectedRow(),-1!==e.row?(e.items=[d.get(e.row)],e.rows=[e.row]):(e.items=[],e.rows=[]);break;case"rows":if(e.rows=b.getSelectedRows(),b.memory&&b.memory.all)e.items=d.data;else if(e.items=[],b.memory&&!Fancy.Object.isEmpty(b.memory.selected)){var f=b.memory.selected;for(var g in f)e.items.push(d.getById(g))}else for(var h=0,i=e.rows.length;h<i;h++)e.items.push(d.get(e.rows[h]))}return a?e:e.items},renderHeaderCheckBox:function(){var a=this,b=this.widget;a._renderHeaderCheckBox(b.leftHeader,b.leftColumns),a._renderHeaderCheckBox(b.header,b.columns),a._renderHeaderCheckBox(b.rightHeader,b.rightColumns)},_renderHeaderCheckBox:function(b,c){var d=this,e=d.memory;a.each(c,function(c,f){if("$selected"===c.index){var g=b.getCell(f).firstChild();c.headerCheckBox=new a.CheckBox({renderTo:g.dom,renderId:!0,value:!1,label:!1,style:{padding:"0px",display:"inline-block"},events:[{change:function(a,b){b?(d.selectAll(),e&&e.setAll()):(d.deSelectAll(),e&&e.clearAll())}}]})}})},selectAll:function(){for(var d=this,e=d.widget,f=e.el.select("."+k+" ."+b),g=0,i=e.getViewTotal();g<i;g++){for(var j=e.el.select("."+h+" ."+c+'[index="'+g+'"] .'+b),l=0,m=j.length;l<m;l++){a.getWidget(j.item(l).attr("id")).setValue(!0)}d.domSelectRow(g)}f.each(function(b){a.getWidget(b.attr("id")).setValue(!0,!1)})},deSelectAll:function(){for(var d=this,e=d.widget,f=0,g=e.getViewTotal();f<g;f++){e.el.select("."+h+" ."+c+'[index="'+f+'"] .'+b).each(function(b){a.getWidget(b.attr("id")).setValue(!1)}),d.domDeSelectRow(f)}d.clearHeaderCheckBox()},clearHeaderCheckBox:function(){this.widget.el.select("."+k+" ."+b).each(function(b){a.getWidget(b.attr("id")).setValue(!1,!1)})},stopSelection:function(){this.enabled=!1},enableSelection:function(a){if(void 0!==a)return void(this.enabled=a);this.enabled=!0},initFixTrackOver:function(){var a=this,b=a.widget;b.columns&&(b.body.el.on("mouseleave",a.onBodyMouseLeave,a),b.body.el.on("mouseenter",a.onBodyMouseEnter,a)),b.leftColumns&&(b.leftBody.el.on("mouseleave",a.onLeftBodyMouseLeave,a),b.leftBody.el.on("mouseenter",a.onLeftBodyMouseEnter,a)),b.rightColumns&&(b.rightBody.el.on("mouseleave",a.onRightBodyMouseLeave,a),b.rightBody.el.on("mouseenter",a.onRightBodyMouseEnter,a))},onBodyMouseLeave:function(){var a=this,b=a.widget;a.clearBodyTrackCls(b.body)},onBodyMouseEnter:function(){var a=this;a.rowTrackFixInBody=!0,setTimeout(function(){a.rowTrackFixInBody=!1},30)},onLeftBodyMouseLeave:function(){var a=this,b=a.widget;a.clearBodyTrackCls(b.leftBody)},onLeftBodyMouseEnter:function(){var a=this;a.rowTrackFixInBody=!0,setTimeout(function(){a.rowTrackFixInBody=!1},30)},onRightBodyMouseLeave:function(){var a=this,b=a.widget;a.clearBodyTrackCls(b.rightBody)},onRightBodyMouseEnter:function(){var a=this;a.rowTrackFixInBody=!0,setTimeout(function(){a.rowTrackFixInBody=!1},30)},clearBodyTrackCls:function(a){var b=this,c=b.widget;c.cellTrackOver&&a.el.select("."+d).removeCls(d),c.trackOver&&(delete a.prevCellOver,b.rowTrackFixInterval&&(clearInterval(b.rowTrackFixInterval),delete b.rowTrackFixInterval),b.rowTrackFixInterval=setTimeout(function(){b.rowTrackFixInBody||c.el.select("."+j).removeCls(j)},20))},onColumnDrag:function(){var b,c=this,d=c.widget;if(c.cells||c.cell||c.column||c.columns)return void c.clearSelection();b=c.getSelection(!0),a.each(b,function(a){d.selectRow(a)})},onColumnLock:function(){var b,c=this,d=c.widget;if(c.cells||c.cell||c.column||c.columns)return void c.clearSelection();b=c.getSelection(!0),a.each(b,function(a){d.selectRow(a)})},onColumnRightLock:function(){var b,c=this,d=c.widget;if(c.cells||c.cell||c.column||c.columns)return void c.clearSelection();b=c.getSelection(!0),a.each(b,function(a){d.selectRow(a)})},onUnColumnLock:function(){var b,c=this,d=c.widget;if(c.cells||c.cell||c.column||c.columns)return void c.clearSelection();b=c.getSelection(!0),a.each(b,function(a){d.selectRow(a)})}})}();